---
title: "What effects do CCTV cameras have in criminal investigations?"
author: "<b>Dr Matt Ashby</b>, University College London"
output:
  xaringan::moon_reader:
    css: ["ucl_basic.css", "animate.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---
class: animated, fadeIn, middle

```{r setup, include=FALSE}
# Set chunk options
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, fig.retina = 10, fig.width = 14)

# Load packages
library(ggtext)
library(png)
library(scales)
library(tidyverse)

# Create a custom ggplot2 theme
theme_presentation <- function (...) {
  theme_minimal(...) %+replace%
    theme(
      axis.text = element_text(size = 11),
      axis.title = element_text(hjust = 1, size = 11),
      legend.position = "bottom",
      legend.text = element_text(size = 11),
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank(),
      plot.caption = element_text(hjust = 1, size = 11, margin = margin(t = 1, unit = "lines")),
      plot.title.position = "plot",
      strip.background = element_blank(),
      strip.text = element_text(size = 11, margin = margin(b = 6))
    )
}

# Create a percent formatting function that adds a space either side for us in
# chart labels
percent_padded <- percent_format(accuracy = 0.1, prefix = " ", suffix = "% ")
```

```{r load-data}
crimes <- here::here("data/crimes.rds") %>% 
  read_rds() %>% 
  filter(year >= 2011 & year <= 2015 & notifiable & !is.na(cctv))
```

<p style="font-size: 3em; font-weight: bold; line-height: 1.4;">“CCTV has been <mark>instrumental</mark> in identifying and <mark>bringing to justice</mark> those involved in all aspects of criminality”</p>

<p style="font-size: 2em; font-style: italic; text-align: right;">– UK National CCTV Strategy</p>

---
class: animated, fadeIn, middle

<p style="font-size: 3em; font-weight: bold; line-height: 1.4;">“DCI Mick Neville [said] ‘Billions of pounds has been spent on kit … It's been <mark>an utter fiasco</mark>: only 3% of crimes were solved by CCTV.’”</p>

<p style="font-size: 2em; font-style: italic; text-align: right;">– The Guardian</p>


---
class: animated, fadeIn, reverse, center, middle

<p style="font-size: 3em; font-weight: bold; line-height: 1.4;">How likely is CCTV to be useful in criminal investigations?</p>

---
class: animated, fadeIn, center, middle
background-image: url("btp_on_tube.jpg")
background-position: center
background-size: cover

```{r chart-data0}
# Create custom annotation functions with many arguments already filled in
annotation_label <- partial(
  annotate, 
  geom = "richtext", 
  fill = NA, 
  hjust = 0, 
  label.padding = unit(1, "lines"),
  label.size = NA, 
  lineheight = 1.1, 
  size = 10, 
  vjust = 1
)
annotation_percent <- partial(
  annotate, 
  geom = "richtext", 
  fill = NA, 
  fontface = "bold",
  hjust = 1, 
  label.padding = unit(1, "lines"),
  label.size = NA, 
  lineheight = 1, 
  size = 20, 
  vjust = 1
)

# Load BTP logo
btp_logo <- grid::rasterGrob(
  readPNG("btp_logo_white.png"), 
  height = unit(12, "lines"),
  width = unit(12 * 2.0603448276, "lines"), # the aspect ratio of the image
  interpolate = TRUE
)

chart_data <- ggplot() +
  geom_rect(aes(xmin = 0, ymin = 0, ymax = 251195, xmax = 1), fill = "#0097A9") +
  theme_void()

# chart_data +
#   annotation_custom(btp_logo, xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf)
```
---
class: animated, fadeIn, center, middle

```{r chart-data1}
chart_data1 <- chart_data +
  annotation_label(
    x = 0, 
    y = 251195, 
    label = "data on 251,195 investigations, 2011–15<br>(50,239 per year)", 
    colour = "white"
  ) +
  annotation_percent(x = 1, y = 251195, label = "100%", colour = "white")

chart_data1
```

---
class: animated, fadeIn, center, middle

```{r chart-data2}
chart_data2 <- chart_data1 +
  geom_rect(aes(xmin = 0, ymin = 0, ymax = 111610, xmax = 1), fill = "#002855") +
  annotation_label(
    x = 0, 
    y = 111610, 
    label = "CCTV was *available* in 22,322 investigations per year", 
    colour = "white"
  ) +
  annotation_percent(x = 1, y = 111610, label = "44%", colour = "white")

chart_data2
```

---
class: animated, fadeIn, center, middle

```{r chart-data3}
chart_data2 +
  geom_rect(aes(xmin = 0, ymin = 0, ymax = 72390, xmax = 1), fill = "#EA7600") +
  annotation_label(
    x = 0, 
    y = 72390, 
    label = "CCTV was *useful* in 14,478 investigations per year", 
    colour = "black"
  ) +
  annotation_percent(x = 1, y = 72390, label = "29%", colour = "black")
```

---
class: animated, fadeIn, center, middle

```{r chart-useful}
crimes_useful <- crimes %>% 
  count(agg_seg, cctv, available) %>% 
  group_by(agg_seg) %>% 
  mutate(
    type = case_when(
      cctv & available ~ "useful",
      available ~ "available",
      TRUE ~ "not available"
    ),
    prop = n / sum(n)
  ) %>% 
  ungroup() %>% 
  select(agg_seg, type, prop) %>% 
  pivot_wider(names_from = type, values_from = prop) %>% 
  # Add the useful prop to the available prop, since CCTV must be available to 
  # be useful
  mutate(
    available = available + useful,
    agg_seg = fct_reorder(agg_seg, available)
  )

chart_useful <- ggplot(crimes_useful, aes(y = agg_seg)) +
  geom_col(aes(x = available, fill = "available")) +
  scale_x_continuous(
    labels = percent_format(accuracy = 1), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_fill_manual(
    values = c("available" = "#002855", "useful" = "#EA7600"),
    labels = c("available" = "CCTV available", "useful" = "CCTV useful")
  ) +
  labs(
    caption = "Base: all crimes",
    x = "proportion of crimes", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()

chart_useful
```

---
class: animated, fadeIn, center, middle

```{r chart-useful2, warning=FALSE}
chart_useful + 
  geom_col(aes(x = useful, fill = "useful"), width = 0.5)
```

---
class: animated, fadeIn, center, middle

```{r chart-detections0}
chart_detections0 <- crimes %>% 
  count(agg_seg, cleared, cctv) %>% 
  group_by(agg_seg, cctv) %>% 
  mutate(
    cctv = recode(as.numeric(cctv), `1` = "useful", `0` = "not_useful"),
    detection_rate = n / sum(n)
  ) %>% 
  ungroup() %>% 
  filter(cleared) %>% 
  select(agg_seg, cctv, detection_rate) %>% 
  pivot_wider(names_from = cctv, values_from = detection_rate) %>% 
  mutate(
    agg_seg = fct_reorder(agg_seg, not_useful),
    diff = useful - not_useful,
    align = as.numeric(diff < 0),
    diff = if_else(
      diff > 0, 
      percent(diff, accuracy = 1, prefix = "+", suffix = "%"), 
      percent(abs(diff), accuracy = 1, prefix = "–", suffix = "%")
    )
  ) %>% 
  ggplot(aes(y = agg_seg, hjust = align, label = diff)) +
  # Transparent geom to force the legend to appear
  geom_segment(
    aes(x = 0, xend = not_useful, yend = agg_seg, colour = "not useful"), 
    alpha = 0,
    key_glyph = draw_key_path, 
    size = 2
  ) +
  scale_x_continuous(
    labels = percent_format(), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(
    values = c("not useful" = "#002855", "useful" = "#EA7600"),
    labels = c(
      "not useful" = "CCTV was not useful",
      "useful" = "CCTV was useful"
    ),
    guide = guide_legend(override.aes = list(alpha = 1, arrow = NULL))
  ) +
  labs(
    caption = "Base: all crimes",
    x = "proportion of offences detected", 
    y = NULL,
    colour = "detection rate in cases where:"
  ) +
  theme_presentation()

chart_detections0
```

---
class: animated, fadeIn, center, middle

```{r chart-detections1}
chart_detections1 <- chart_detections0 +
  geom_segment(
    aes(x = 0, xend = not_useful, yend = agg_seg, colour = "not useful"), 
    key_glyph = draw_key_path, 
    size = 2
  ) +
  geom_point(
    aes(x = not_useful, colour = "not useful"), 
    key_glyph = draw_key_path, 
    size = 4
  )
  
chart_detections1 +
  geom_label(
    aes(x = not_useful, label = percent(not_useful, accuracy = 1)), 
    hjust = 0, 
    label.padding = unit(0.5, "lines"),
    label.size = NA
  ) +
  geom_point(
    aes(x = not_useful, colour = "not useful"), 
    key_glyph = draw_key_path, 
    size = 4
  )
```

---
class: animated, fadeIn, center, middle

```{r chart-detections2}
chart_detections1 +
  geom_label(
    aes(x = useful), 
    label.padding = unit(0.5, "lines"), 
    key_glyph = draw_key_path, 
    label.size = NA
  ) +
  geom_segment(
    aes(x = not_useful, xend = useful, yend = agg_seg, colour = "useful"), 
    arrow = arrow(angle = 45, length = unit(0.5, "lines"), type = "closed"), 
    key_glyph = draw_key_path, 
    size = 2
  ) +
  geom_point(
    aes(x = not_useful, colour = "not useful"), 
    key_glyph = draw_key_path, 
    size = 4
  )
```

---
class: animated, fadeIn, reverse, center, middle

<p style="font-size: 3em; font-weight: bold; line-height: 1.4;">Why does CCTV sometimes fail?</p>

---
class: animated, fadeIn, center, middle

```{r chart-reasons, warning=FALSE}
crimes_reasons <- crimes %>% 
  count(reason) %>% 
  mutate(
    prop = n / sum(n),
    reason = fct_rev(recode_factor(
      reason, 
      "NO CCTV" = "location not covered", 
      "CCTV NOT REQUESTED/VIEWED" = "recording not requested", 
      "SYSTEM IN FAULT (NO IMAGES AVAILABLE)" = "system faulty", 
      "IMAGES OVERWRITTEN (TIMED OUT)" = "recording over-written", 
      "INCIDENT NOT CAPTURED ON CCTV" = "incident not shown", 
      "IMAGES OF INSUFFICIENT QUALITY" = "insufficient quality", 
      "WRONG IMAGES" = "wrong images", 
      .missing = "CCTV useful"
    )),
    reason_group = case_when(
      reason %in% c(
        "recording not requested", 
        "location not covered", 
        "system faulty", 
        "recording over-written"
      ) ~ "not available",
      reason %in% c(
        "incident not shown", 
        "insufficient quality", 
        "wrong images"
      ) ~ "not useful",
      TRUE ~ "useful"
    )
  ) %>% 
  # Make the data wider so each series can be progressively added as a separate 
  # geom
  pivot_wider(names_from = reason_group, values_from = prop, values_fill = 0) %>% 
  mutate(
    total = `not available` + `not useful` + useful,
    align = as.numeric(total > 0.05),
    # Now change the missing values back from 0 to NA so they can be excluded
    # from the chart
    across(c(`not available`, `not useful`, useful), ~ if_else(. == 0, NA_real_, .))
  )

chart_reasons0 <- ggplot(
  crimes_reasons,
  aes(x = total, y = reason, colour = as.character(align), hjust = align)
) +
  geom_col(
    aes(x = `not available`, fill = "not available"), 
    na.rm = TRUE, 
    alpha = 0,
    colour = NA
  ) +
  # Transparent geom to force the legend to appear
  scale_x_continuous(
    labels = percent_format(), 
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(values = c("0" = "black", "1" = "white")) +
  scale_fill_manual(
    values = c(
      "useful" = "#EA7600", 
      "not available" = "#0097A9", 
      "not useful" = "#002855"
    ),
    labels = c(
      "useful" = "CCTV useful",
      "not available" = "CCTV not available",
      "not useful" = "CCTV available but not useful"
    ),
    guide = guide_legend(override.aes = list(alpha = 1))
  ) +
  labs(
    caption = "Base: all crimes",
    x = "proportion of crimes", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()

chart_reasons0
```

---
class: animated, fadeIn, center, middle

```{r chart-reasons1, warning=FALSE}
chart_reasons1 <- chart_reasons0 +
  geom_col(
    aes(x = `not available`, fill = "not available"), 
    na.rm = TRUE, 
    colour = NA
  ) +
  geom_text(
    aes(label = percent_padded(`not available`)), 
    na.rm = TRUE, 
    show.legend = FALSE
  )

chart_reasons1
```

---
class: animated, fadeIn, center, middle

```{r chart-reasons2, warning=FALSE}
chart_reasons2 <- chart_reasons1 +
  geom_col(aes(x = `not useful`, fill = "not useful"), na.rm = TRUE, colour = NA) +
  geom_text(aes(label = percent_padded(`not useful`)), na.rm = TRUE, show.legend = FALSE)

chart_reasons2
```

---
class: animated, fadeIn, center, middle

```{r chart-reasons3, warning=FALSE}
chart_reasons2 +
  geom_col(aes(x = `useful`, fill = "useful"), na.rm = TRUE, colour = NA) +
  geom_text(aes(label = percent_padded(`useful`)), na.rm = TRUE, show.legend = FALSE)
```

---
class: animated, fadeIn, center, middle

### Some crimes were in locations not covered by CCTV

```{r chart-not-covered}
crimes %>% 
  mutate(reason = if_else(is.na(reason), "useful", reason)) %>% 
  mutate(this_cat = reason != "NO CCTV" | is.na(reason)) %>% 
  count(agg_seg, this_cat) %>% 
  group_by(agg_seg) %>% 
  mutate(
    prop = n / sum(n),
    align = prop > 0.1,
    label = percent_padded(prop)
  ) %>% 
  ungroup() %>% 
  filter(!this_cat) %>% 
  mutate(agg_seg = fct_reorder(agg_seg, prop)) %>% 
  ggplot(
    aes(prop, agg_seg, colour = align, hjust = as.numeric(align), label = label)
  ) +
  geom_col(colour = NA, fill = "#0097A9") +
  geom_text(na.rm = TRUE, show.legend = FALSE) +
  scale_x_continuous(
    labels = scales::percent_format(accuracy = 1), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(values = c(`FALSE` = "black", `TRUE` = "white")) +
  labs(
    caption = "Base: all crimes",
    x = "proportion of crimes occurring in places not covered by CCTV", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()
```

---
class: animated, fadeIn, center, middle

### CCTV is more likely to be available in some places

```{r chart-location}
crimes %>% 
  filter(prem_type != "OTHER") %>% 
  mutate(
    prem_type = recode_factor(
      prem_type,
      "STATION" = "crimes at\nstations",
      "ONTRAIN" = "crimes onboard\ntrains",
      "CARPK" = "crimes in\ncar parks",
      "LINESIDE" = "crimes along\nrailway tracks"
    ),
    reason_group = case_when(
      reason %in% c(
        "CCTV NOT REQUESTED/VIEWED", 
        "NO CCTV", 
        "SYSTEM IN FAULT (NO IMAGES AVAILABLE)", 
        "IMAGES OVERWRITTEN (TIMED OUT)"
      ) ~ "not available",
      reason %in% c(
        "INCIDENT NOT CAPTURED ON CCTV", 
        "IMAGES OF INSUFFICIENT QUALITY", 
        "WRONG IMAGES"
      ) ~ "not useful",
      TRUE ~ "useful"
    )
  ) %>% 
  count(prem_type, reason_group) %>% 
  group_by(prem_type) %>% 
  mutate(
    prop = n / sum(n),
    prop_order = first(prop),
    label = percent_padded(prop)
  ) %>% 
  ungroup() %>% 
  mutate(prem_type = fct_reorder(prem_type, prop_order)) %>% 
  ggplot(aes(x = prop, y = prem_type, fill = reason_group, label = label)) + 
  geom_col() + 
  geom_text(
    aes(colour = reason_group == "useful"), 
    position = position_stack(vjust = .5),
    show.legend = FALSE
  ) +
  scale_x_continuous(
    labels = scales::percent_format(accuracy = 1), 
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(values = c(`TRUE` = "black", `FALSE` = "white")) +
  scale_fill_manual(
    values = c(
      "useful" = "#EA7600", 
      "not available" = "#0097A9", 
      "not useful" = "#002855"
    ),
    labels = c(
      "useful" = "CCTV useful",
      "not available" = "CCTV not available",
      "not useful" = "CCTV available but not useful"
    ),
    expand = expansion(mult = c(0, 0))
  ) +
  labs(
    caption = "Base: all crimes",
    x = "proportion of crimes", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()
```

---
class: animated, fadeIn, center, middle

### Sometimes investigators did not request CCTV

```{r chart-not-requested}
crimes %>% 
  mutate(reason = if_else(is.na(reason), "useful", reason)) %>% 
  filter(reason != "NO CCTV") %>% 
  mutate(this_cat = reason != "CCTV NOT REQUESTED/VIEWED" | is.na(reason)) %>% 
  count(agg_seg, this_cat) %>% 
  group_by(agg_seg) %>% 
  mutate(
    prop = n / sum(n),
    align = prop > 0.1,
    label = percent_padded(prop)
  ) %>% 
  ungroup() %>% 
  filter(!this_cat) %>% 
  mutate(agg_seg = fct_reorder(agg_seg, prop)) %>% 
  ggplot(
    aes(prop, agg_seg, colour = align, hjust = as.numeric(align), label = label)
  ) +
  geom_col(colour = NA, fill = "#0097A9") +
  geom_text(na.rm = TRUE, show.legend = FALSE) +
  scale_x_continuous(
    labels = scales::percent_format(accuracy = 1), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(values = c(`FALSE` = "black", `TRUE` = "white")) +
  labs(
    caption = "Base: all crimes in locations covered by CCTV",
    x = "proportion of crimes for which investigators did not request CCTV", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()
```

---
class: animated, fadeIn, center, middle

### … even though CCTV can be just as useful for minor crimes

```{r chart-violence}
crimes %>% 
  mutate(reason = if_else(is.na(reason), "useful", reason)) %>%  
  filter(
    !reason %in% c("NO CCTV", "CCTV NOT REQUESTED/VIEWED"), 
    agg_seg == "Violence", 
    segment != "Homicide"
  ) %>% 
  count(segment, cctv) %>% 
  group_by(segment) %>% 
  mutate(prop = n / sum(n)) %>%
  ungroup() %>% 
  filter(cctv) %>% 
  mutate(
    segment = fct_relevel(
      segment, 
      "Violence with serious injury", 
      "Violence with minor injury", 
      "Violence without injury"
    )
  ) %>% 
  ggplot(aes(prop, segment, fill = segment, label = percent_padded(prop))) +
  geom_col() +
  geom_text(colour = "white", hjust = 1) +
  scale_x_continuous(
    labels = scales::percent_format(accuracy = 1), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_fill_manual(values = c("#555025", "#8F993E", "#B5BD00")) +
  labs(
    caption = "Base: all crimes for which CCTV was requested",
    x = "proportion of crimes for which CCTV was useful", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation() +
  theme(legend.position = "none")
```

---
class: animated, fadeIn, center, middle

### The more hours of CCTV to be watched,<br>the less likely investigators will request it

```{r chart-aoristic, message=FALSE}
crimes %>% 
  mutate(reason = if_else(is.na(reason), "useful", reason)) %>% 
  filter(
    segment %in% c(
      "Burglary", 
      "Criminal damage", 
      "Theft pedal cycle", 
      "Theft from motor vehicle"
    ), 
    !is.na(cctv), 
    reason != "NO CCTV", 
    window <= 24 * 7
  ) %>% 
  mutate(
    requested = reason != "CCTV NOT REQUESTED/VIEWED" | is.na(reason),
    window = window / 24
  ) %>% 
  ggplot(aes(x = window, y = as.numeric(requested))) + 
  geom_smooth(level = 0.8, colour = "#555025", fill = "#BBC592") + 
  scale_y_continuous(
    labels = percent_format(accuracy = 1), 
    limits = c(0, 1), 
    expand = expansion(mult = c(0, 0.02)),
    oob = squish
  ) + 
  facet_grid(cols = vars(segment)) + 
  labs(
    caption = "Base: all crimes in locations covered by CCTV",
    x = "number of days in which the crime could have occurred",
    y = "probability of CCTV being requested by investigator"
  ) +
  coord_cartesian() +
  theme_presentation() + 
  theme(
    axis.ticks.x = element_line(colour = "grey92"),
    panel.grid.major.x = element_blank(), 
    panel.grid.minor.x = element_blank(), 
    panel.grid.major.y = element_line(), 
    panel.grid.minor.y = element_line()
  )
```


---
class: animated, fadeIn, center, middle
background-image: url("hansworth-booth-street-metro-1.png")
background-position: top
background-size: cover


---
class: animated, fadeIn, center, middle

### Sometimes CCTV quality was too poor

```{r chart-quality}
crimes %>% 
  mutate(reason = if_else(is.na(reason), "useful", reason)) %>% 
  filter(
    !reason %in% c(
      "NO CCTV", 
      "CCTV NOT REQUESTED/VIEWED", 
      "SYSTEM IN FAULT (NO IMAGES AVAILABLE)",
      "IMAGES OVERWRITTEN (TIMED OUT)",
      "INCIDENT NOT CAPTURED ON CCTV"
    )
  ) %>% 
  mutate(this_cat = reason != "IMAGES OF INSUFFICIENT QUALITY" | is.na(reason)) %>% 
  count(agg_seg, this_cat) %>% 
  group_by(agg_seg) %>% 
  mutate(
    prop = n / sum(n),
    align = prop > 0.1,
    label = percent_padded(prop)
  ) %>% 
  ungroup() %>% 
  filter(!this_cat) %>% 
  mutate(agg_seg = fct_reorder(agg_seg, prop)) %>% 
  ggplot(
    aes(prop, agg_seg, colour = align, hjust = as.numeric(align), label = label)
  ) +
  geom_col(colour = NA, fill = "#002855") +
  geom_text(na.rm = TRUE, show.legend = FALSE) +
  scale_x_continuous(
    labels = scales::percent_format(accuracy = 1), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(values = c(`FALSE` = "black", `TRUE` = "white")) +
  labs(
    caption = "Base: all crimes for which CCTV was available",
    x = "proportion of crimes for which CCTV showed the incident", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()
```

---
class: animated, fadeIn, big-text

# Questions for police

--

Do you know how often CCTV is useful in your investigations?

--

Do you know in what circumstances CCTV fails to assist?

--

Do your detectives always look for CCTV?


---
class: animated, fadeIn, big-text

# Questions for CCTV system operators

--

How good is your system at assisting investigations?

--

Is your system well maintained?

--

Can you extract recordings if needed?


---
class: animated, fadeIn, big-text, middle

# Thanks!

These slides: <a href="http://lesscrime.info/slides/trygghetnu/" style="color: black; font-weight: bold; text-decoration: none;">lesscrime.info/slides/trygghetnu</a>

`r icons::fontawesome("twitter-square")` **@lesscrime**

`r icons::fontawesome("envelope-square")` **matthew.ashby@ucl.ac.uk**

<p style="font-size: 1em;">Images: <a href="https://unsplash.com/@lianhao?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Lianhao Qu</a>, <a href="https://flic.kr/p/4SqiUU">Gordon Joly</a>, <a href="https://flic.kr/p/7sNneP">Tim Shields</a>.</p>


---
class: animated, fadeIn, center, middle

<!-- ### Sometimes requested CCTV did not show the incident -->

```{r chart-not-captured, eval=FALSE}
crimes %>% 
  mutate(reason = if_else(is.na(reason), "useful", reason)) %>% 
  filter(
    !reason %in% c(
      "NO CCTV", 
      "CCTV NOT REQUESTED/VIEWED", 
      "SYSTEM IN FAULT (NO IMAGES AVAILABLE)",
      "IMAGES OVERWRITTEN (TIMED OUT)"
    )
  ) %>% 
  mutate(this_cat = reason != "INCIDENT NOT CAPTURED ON CCTV" | is.na(reason)) %>% 
  count(agg_seg, this_cat) %>% 
  group_by(agg_seg) %>% 
  mutate(
    prop = n / sum(n),
    align = prop > 0.1,
    label = percent_padded(prop)
  ) %>% 
  ungroup() %>% 
  filter(!this_cat) %>% 
  mutate(agg_seg = fct_reorder(agg_seg, prop)) %>% 
  ggplot(
    aes(prop, agg_seg, colour = align, hjust = as.numeric(align), label = label)
  ) +
  geom_col(colour = NA, fill = "#002855") +
  geom_text(na.rm = TRUE, show.legend = FALSE) +
  scale_x_continuous(
    labels = scales::percent_format(accuracy = 1), 
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_colour_manual(values = c(`FALSE` = "black", `TRUE` = "white")) +
  labs(
    caption = "Base: all crimes for which CCTV was available",
    x = "proportion of crimes for which CCTV did not show incident", 
    y = NULL, 
    fill = NULL
  ) +
  theme_presentation()
```

